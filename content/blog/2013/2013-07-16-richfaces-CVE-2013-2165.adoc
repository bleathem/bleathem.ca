---
  title: RichFaces Security Advisory CVE-2013-2165
  date: 2013-07-16
  author: Brian Leathem
  categories: [Java EE]
  tags: [RichFaces, security, cve, RF3, RF43]
  description:
  linktitle:
  featured:
  featuredpath:
  featuredalt:
  type: post
  aliases:
    - /blog/2013/07/richfaces-CVE-2013-2165.html
---
= RichFaces Security Advisory CVE-2013-2165

image::/img/blog/common/richfaces.png[RichFaces, float="right", link="http://richfaces.org/"]

We have fixed a security vulnerability in RichFaces 3, 4 and 5.  Details of the vulnerability can be found in this http://rhn.redhat.com/errata/RHSA-2013-1041.html[Red Hat Errata document] released for our http://www.redhat.com/products/jbossenterprisemiddleware/web-framework-kit/[WFK product].  We have released community micro releases addressing this vulnerability, so please update your applications ASAP.  Read below for a summary of the problem and an explanation of how to use the fix in your applications.

[.alert.alert-warning]
Download http://www.jboss.org/richfaces/download/stable[RichFaces 3.3.4.Final] or http://www.jboss.org/richfaces/download/stable[RichFaces 4.3.3.Final] and use them in your applications to protect yourself from this vulnerability.

== The vulnerability

The vulnerability consists of using RichFaces resource deserialisation to trigger the deserialisation methods of *any* class deployed in the server.  The extent of the vulnerability is limited by the classes available, but could potentially let the attacker cause a denial-of-service condition or — in extreme cases — to inject arbitrary code http://www.ibm.com/developerworks/library/se-lookahead/[[1\]].

== The fix

The fix involved creating a whitelist of classes that are available to participate in the RichFaces resource deserialisation process.  Details of the implementation of the fix are well described in this article on http://www.ibm.com/developerworks/library/se-lookahead/[Look-ahead Java deserialization] in the IBM developerworks.

The whitelist that ships with RichFaces 3, 4, 5 consist of the classes for the primitive tpyes, as well as classes that implement the following interfaces:

* https://svn.jboss.org/repos/richfaces/branches/3.3.1.SP3_JBPAPP-10813/framework/impl/src/main/resources/org/ajax4jsf/resource/resource-serialization.properties[RichFaces 3]
** org.ajax4jsf.resource.InternetResource
** org.ajax4jsf.resource.SerializableResource
** javax.el.Expression
** javax.faces.el.MethodBinding
** javax.faces.component.StateHolderSaver
** java.awt.Color
* https://github.com/richfaces4/core/blob/release/4.3.3.Final/impl/src/main/resources/org/richfaces/resource/resource-serialization.properties[RichFaces 4], or https://github.com/richfaces/richfaces/blob/master/framework/src/main/resources/org/richfaces/resource/resource-serialization.properties[RichFaces 5]
** javax.faces.application.Resource
** javax.el.Expression
** org.richfaces.resource.SerializableResource
** javax.faces.component.StateHolderSaver

Notice the +SerializableResource+ interface - this is an interface you can implement in your classes to allow them to participate in Richfaces resource deserialisation.  This however is not something you will have to do unless you have gotten into some serious resource customisation.

Alternatively, you can copy the +resource-serialization.properties+ file into your own application (using the same package) and add additional interface/class names to the whitelist.  This will enable you to have your classes participate in the deserialisation process without needing to compile.

[.alert.alert-info]
Note: while we have included the patch in RichFaces 5, we have not shipped an update to the RichFaces 5.0.0.Alpha1 release.  The fix will be present in an upciming 5.0.0.Alpha2 release.
